-- Console Logger untuk Mobile Executor
-- VERSI DIPERBAIKI 12 (Memperbaiki Tombol "Salin Semua" / Copy All)

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local LogService = game:GetService("LogService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")

-- Variabel untuk menyimpan log dan status
local logs = {}
local maxLogs = 500
local isKilled = false
local perfRunning = true
local connections = {} 
local selectedLog = nil
local isMinimized = false
local filters = {
    Output = true,
    Information = true,
    Warning = true,
    Error = true
}

-- Variabel untuk menyimpan fungsi bawaan (untuk pemulihan)
local oldPrint = print
local oldWarn = warn

-- Deklarasi forward untuk variabel UI utama
local screenGui, mainFrame, logsContainer, logsLayout, fpsLabel, frameLabel, pingLabel, memLabel, closeBtn 
local minimizedFrame, minButton, clearBtn, minimizeBtn
local outputBtn, outputCheck, outputMark, infoBtn, infoCheck, infoMark, warnBtn, warnCheck, warnMark, errorBtn, errorCheck, errorMark
local copyAllBtn, copySelectedBtn

-- =========================================================
-- FUNGSI PEMUTUS PERMANEN (KILL SWITCH)
-- =========================================================

local function killLogger()
    if isKilled then return end
    isKilled = true
    
    -- 1. Hentikan pemantauan performa
    perfRunning = false
    
    -- 2. Kembalikan fungsi print dan warn ke bawaan Roblox
    print = oldPrint
    warn = oldWarn
    
    -- 3. Putuskan SEMUA koneksi
    for _, conn in pairs(connections) do
        if conn and conn.Connected then
            conn:Disconnect()
        end
    end
    
    -- 4. Hancurkan GUI
    if screenGui then
        screenGui:Destroy()
    end
    
    oldPrint("--- Console Logger: SEMUA FUNGSI DIMATIKAN SECARA PERMANEN (Kill Switch Aktif) ---")
end

-- =========================================================
-- FUNGSI BANTUAN LOGGING DAN UI
-- =========================================================

local function updateLogVisibility()
    for _, log in ipairs(logs) do
        local shouldShow = false
        
        if log.type == Enum.MessageType.MessageOutput and filters.Output then
            shouldShow = true
        elseif log.type == Enum.MessageType.MessageInfo and filters.Information then
            shouldShow = true
        elseif log.type == Enum.MessageType.MessageWarning and filters.Warning then
            shouldShow = true
        elseif log.type == Enum.MessageType.MessageError and filters.Error then
            shouldShow = true
        end
        
        log.frame.Visible = shouldShow
    end
    
    task.wait()
    if logsLayout and logsContainer then
        logsContainer.CanvasSize = UDim2.new(0, 0, 0, logsLayout.AbsoluteContentSize.Y + 10)
        logsContainer.CanvasPosition = Vector2.new(0, logsContainer.CanvasSize.Y.Offset)
    end
end

local function addLog(message, logType)
    if isKilled then return end
    if not logsContainer or not logsLayout then return end 
    
    if #logs >= maxLogs then
        table.remove(logs, 1)
        if logsContainer:GetChildren()[2] then logsContainer:GetChildren()[2]:Destroy() end
    end
    
    local logFrame = Instance.new("Frame")
    logFrame.Size = UDim2.new(1, -10, 0, 0)
    logFrame.AutomaticSize = Enum.AutomaticSize.Y
    logFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
    logFrame.BorderSizePixel = 0
    logFrame.Parent = logsContainer
    
    local logCorner = Instance.new("UICorner")
    logCorner.CornerRadius = UDim.new(0, 6)
    logCorner.Parent = logFrame
    
    local typeColor = Color3.fromRGB(150, 150, 150)
    local typeIcon = "ðŸ“"
    
    if logType == Enum.MessageType.MessageWarning then
        typeColor = Color3.fromRGB(240, 180, 50)
        typeIcon = "âš ï¸"
    elseif logType == Enum.MessageType.MessageError then
        typeColor = Color3.fromRGB(220, 50, 50)
        typeIcon = "âŒ"
    elseif logType == Enum.MessageType.MessageInfo then
        typeColor = Color3.fromRGB(50, 150, 220)
        typeIcon = "â„¹ï¸"
    end
    
    local indicator = Instance.new("Frame")
    indicator.Size = UDim2.new(0, 4, 1, 0)
    indicator.BackgroundColor3 = typeColor
    indicator.BorderSizePixel = 0
    indicator.Parent = logFrame
    
    local logText = Instance.new("TextLabel")
    logText.Size = UDim2.new(1, -15, 1, 0)
    logText.Position = UDim2.new(0, 10, 0, 0)
    logText.BackgroundTransparency = 1
    logText.Text = typeIcon .. " " .. message
    logText.TextColor3 = Color3.fromRGB(230, 230, 230)
    logText.TextSize = 12
    logText.Font = Enum.Font.Code
    logText.TextXAlignment = Enum.TextXAlignment.Left
    logText.TextYAlignment = Enum.TextYAlignment.Top
    logText.TextWrapped = true
    logText.AutomaticSize = Enum.AutomaticSize.Y
    logText.Parent = logFrame
    
    local logPadding = Instance.new("UIPadding")
    logPadding.PaddingTop = UDim.new(0, 5)
    logPadding.PaddingBottom = UDim.new(0, 5)
    logPadding.Parent = logFrame
    
    local selectBtn = Instance.new("TextButton")
    selectBtn.Size = UDim2.new(1, 0, 1, 0)
    selectBtn.BackgroundTransparency = 1
    selectBtn.Text = ""
    selectBtn.Parent = logFrame
    
    selectBtn.MouseButton1Click:Connect(function()
        if selectedLog then selectedLog.BackgroundColor3 = Color3.fromRGB(30, 30, 35) end
        selectedLog = logFrame
        logFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
    end)
    
    table.insert(logs, {frame = logFrame, text = message, type = logType, isSelected = false})
    task.spawn(updateLogVisibility)
end

local function clearLogs()
    for _, log in ipairs(logs) do
        if log.frame then log.frame:Destroy() end
    end
    logs = {}
    selectedLog = nil
    if logsContainer then logsContainer.CanvasSize = UDim2.new(0, 0, 0, 0) end
end

local function copyToClipboard(text)
    if setclipboard then
        setclipboard(text)
        addLog("âœ… Teks berhasil disalin ke clipboard!", Enum.MessageType.MessageInfo)
    else
        addLog("âŒ Executor tidak mendukung clipboard!", Enum.MessageType.MessageError)
    end
end

-- =========================================================
-- FUNGSI PERFORMANCE STATS
-- =========================================================

local frameTimes = {}
local FPS_HISTORY = 30

local function getPingMs()
    local LocalPlayer = Players.LocalPlayer
    local ok, p = pcall(function() return LocalPlayer and LocalPlayer:GetNetworkPing() end)
    return ok and p and math.floor(p * 1000) or 0
end

local function startPerfMonitor()
    local function getLuaMemoryKB()
        local ok, mem = pcall(function() return collectgarbage("count") end)
        return ok and mem or 0
    end
    
    connections.perfConnection = RunService.RenderStepped:Connect(function(dt)
        if not perfRunning then return end
        table.insert(frameTimes, dt)
        if #frameTimes > FPS_HISTORY then 
            table.remove(frameTimes, 1) 
        end
    end)

    task.spawn(function()
        while perfRunning do
            if isKilled then break end 

            if fpsLabel and frameLabel and pingLabel and memLabel then
                
                local sum = 0
                for _, v in ipairs(frameTimes) do sum = sum + v end
                local fps, avgMs = 0, 0
                if #frameTimes > 0 then
                    local mean = sum / #frameTimes
                    fps = math.floor(1 / mean + 0.5)
                    avgMs = math.floor(mean * 1000 * 100) / 100
                end
                
                local memKB = getLuaMemoryKB()
                local pingMs = getPingMs()
                
                local fpsColor = Color3.fromRGB(0, 220, 0)
                if fps < 40 then fpsColor = Color3.fromRGB(255, 170, 0) end
                if fps < 25 then fpsColor = Color3.fromRGB(255, 70, 70) end
                
                fpsLabel.Text = "FPS: " .. fps
                fpsLabel.TextColor3 = fpsColor
                frameLabel.Text = "Frame: " .. avgMs .. "ms"
                pingLabel.Text = "Ping: " .. pingMs .. "ms"
                memLabel.Text = "Mem: " .. math.floor(memKB) .. "KB"
            end
            
            task.wait(0.5)
        end
    end)
end

-- =========================================================
-- INISIALISASI UI & EVENT HANDLERS
-- =========================================================

local function createUI()
    local success, err = pcall(function()
        -- 1. ScreenGui Setup
        screenGui = Instance.new("ScreenGui")
        screenGui.Name = "ConsoleLogger"
        screenGui.ResetOnSpawn = false
        screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

        local parentSuccess = pcall(function()
            if gethui then screenGui.Parent = gethui()
            elseif syn and syn.protect_gui then
                syn.protect_gui(screenGui)
                screenGui.Parent = game:GetService("CoreGui")
            else screenGui.Parent = game:GetService("CoreGui") end
        end)
        
        -- 2. Main Frame Setup
        mainFrame = Instance.new("Frame")
        mainFrame.Name = "MainFrame"
        mainFrame.Size = UDim2.new(0, 450, 0, 350)
        mainFrame.Position = UDim2.new(0.5, -225, 0.5, -175)
        mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
        mainFrame.BorderSizePixel = 0
        mainFrame.Active = true
        mainFrame.Draggable = true
        mainFrame.Parent = screenGui

        local mainCorner = Instance.new("UICorner")
        mainCorner.CornerRadius = UDim.new(0, 12)
        mainCorner.Parent = mainFrame
        
        -- Header UI
        local header = Instance.new("Frame")
        header.Name = "Header"
        header.Size = UDim2.new(1, 0, 0, 75)
        header.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
        header.BorderSizePixel = 0
        header.Parent = mainFrame

        local headerCorner = Instance.new("UICorner")
        headerCorner.CornerRadius = UDim.new(0, 12)
        headerCorner.Parent = header
        
        -- Fix corner bawah header
        local headerCoverBottom = Instance.new("Frame")
        headerCoverBottom.Size = UDim2.new(1, 0, 0, 12)
        headerCoverBottom.Position = UDim2.new(0, 0, 1, -12)
        headerCoverBottom.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
        headerCoverBottom.BorderSizePixel = 0
        headerCoverBottom.Parent = header

        -- TITLE
        local title = Instance.new("TextLabel")
        title.Name = "Title"
        title.Size = UDim2.new(0, 150, 0, 35)
        title.Position = UDim2.new(0, 15, 0, 5)
        title.BackgroundTransparency = 1
        title.Text = "ðŸ“‹ Console Logger"
        title.TextColor3 = Color3.fromRGB(255, 255, 255)
        title.TextSize = 16
        title.Font = Enum.Font.GothamBold
        title.TextXAlignment = Enum.TextXAlignment.Left
        title.Parent = header

        -- Performance Stats UI
        local perfStatsFrame = Instance.new("Frame")
        perfStatsFrame.Size = UDim2.new(0, 240, 0, 35)
        perfStatsFrame.Position = UDim2.new(0, 170, 0, 5)
        perfStatsFrame.BackgroundTransparency = 1
        perfStatsFrame.ClipsDescendants = true
        perfStatsFrame.Parent = header

        local statsRow1 = Instance.new("Frame")
        statsRow1.Size = UDim2.new(1, 0, 0, 15)
        statsRow1.BackgroundTransparency = 1
        statsRow1.Parent = perfStatsFrame

        local statsRow2 = Instance.new("Frame")
        statsRow2.Size = UDim2.new(1, 0, 0, 15)
        statsRow2.Position = UDim2.new(0, 0, 0, 17)
        statsRow2.BackgroundTransparency = 1
        statsRow2.Parent = perfStatsFrame

        local function createHeaderStatLabel(parent, posX, text, widthScale)
            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(widthScale, 0, 1, 0)
            label.Position = UDim2.new(posX, 0, 0, 0)
            label.BackgroundTransparency = 1
            label.Text = text
            label.TextColor3 = Color3.fromRGB(180, 180, 180)
            label.TextSize = 9
            label.Font = Enum.Font.GothamMedium
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.Parent = parent
            return label
        end

        fpsLabel = createHeaderStatLabel(statsRow1, 0, "FPS: --", 0.4) 
        frameLabel = createHeaderStatLabel(statsRow1, 0.34, "Frame: --", 0.58) 

        pingLabel = createHeaderStatLabel(statsRow2, 0, "Ping: --", 0.4) 
        memLabel = createHeaderStatLabel(statsRow2, 0.34, "Mem: --", 0.58) 

        -- Buttons Container
        local buttonsContainer = Instance.new("Frame")
        buttonsContainer.Name = "ButtonsContainer"
        buttonsContainer.Size = UDim2.new(0, 100, 0, 35)
        buttonsContainer.Position = UDim2.new(1, -110, 0, 5)
        buttonsContainer.BackgroundTransparency = 1
        buttonsContainer.Parent = header

        local function createHeaderButton(text, position, color)
            local button = Instance.new("TextButton")
            button.Size = UDim2.new(0, 30, 0, 30)
            button.Position = position
            button.BackgroundColor3 = color
            button.BorderSizePixel = 0
            button.Text = text
            button.TextColor3 = Color3.fromRGB(255, 255, 255)
            button.TextSize = 18
            button.Font = Enum.Font.GothamBold
            button.Parent = buttonsContainer
            
            local corner = Instance.new("UICorner")
            corner.CornerRadius = UDim.new(0, 8)
            corner.Parent = button
            return button
        end

        clearBtn = createHeaderButton("ðŸ—‘", UDim2.new(0, 0, 0, 0), Color3.fromRGB(220, 50, 50))
        minimizeBtn = createHeaderButton("âˆ’", UDim2.new(0, 35, 0, 0), Color3.fromRGB(240, 180, 50))
        closeBtn = createHeaderButton("Ã—", UDim2.new(0, 70, 0, 0), Color3.fromRGB(220, 50, 50)) 

        -- Filter Row
        local filterRow = Instance.new("Frame")
        filterRow.Name = "FilterRow"
        filterRow.Size = UDim2.new(1, -20, 0, 32)
        filterRow.Position = UDim2.new(0, 10, 0, 40)
        filterRow.BackgroundTransparency = 1
        filterRow.Parent = header

        -- Log Label
        local logLabel = Instance.new("TextLabel")
        logLabel.Name = "LogLabel"
        logLabel.Size = UDim2.new(0, 35, 1, 0)
        logLabel.BackgroundTransparency = 1
        logLabel.Text = "Log"
        logLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
        logLabel.TextSize = 12
        logLabel.Font = Enum.Font.GothamMedium
        logLabel.TextXAlignment = Enum.TextXAlignment.Left
        logLabel.Parent = filterRow

        -- Filter Container
        local filterContainer = Instance.new("Frame")
        filterContainer.Name = "FilterContainer"
        filterContainer.Size = UDim2.new(1, -40, 1, 0)
        filterContainer.Position = UDim2.new(0, 40, 0, 0) 
        filterContainer.BackgroundTransparency = 1
        filterContainer.Parent = filterRow

        local filterLayout = Instance.new("UIListLayout")
        filterLayout.FillDirection = Enum.FillDirection.Horizontal
        filterLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
        filterLayout.VerticalAlignment = Enum.VerticalAlignment.Center
        filterLayout.SortOrder = Enum.SortOrder.LayoutOrder
        filterLayout.Padding = UDim.new(0, 6)
        filterLayout.Parent = filterContainer
        
        local function createFilterCheckbox(filterName, icon, text, order)
            local frame = Instance.new("Frame")
            frame.Size = UDim2.new(0, 80, 1, 0)
            frame.LayoutOrder = order
            frame.BackgroundTransparency = 1
            frame.Parent = filterContainer
            
            local button = Instance.new("TextButton")
            button.Size = UDim2.new(1, 0, 1, 0)
            button.BackgroundColor3 = Color3.fromRGB(45, 45, 50)
            button.BorderSizePixel = 0
            button.Text = ""
            button.Parent = frame

            local btnCorner = Instance.new("UICorner")
            btnCorner.CornerRadius = UDim.new(0, 6)
            btnCorner.Parent = button
            
            local checkbox = Instance.new("Frame")
            checkbox.Name = "Checkbox"
            checkbox.Size = UDim2.new(0, 16, 0, 16)
            checkbox.Position = UDim2.new(0, 5, 0.5, -8)
            checkbox.BackgroundColor3 = Color3.fromRGB(50, 150, 220)
            checkbox.BorderSizePixel = 0
            checkbox.Parent = button
            
            local checkCorner = Instance.new("UICorner")
            checkCorner.CornerRadius = UDim.new(0, 3)
            checkCorner.Parent = checkbox

            local checkmark = Instance.new("TextLabel")
            checkmark.Size = UDim2.new(1, 0, 1, 0)
            checkmark.BackgroundTransparency = 1
            checkmark.Text = "âœ“"
            checkmark.TextColor3 = Color3.fromRGB(255, 255, 255)
            checkmark.TextSize = 11
            checkmark.Font = Enum.Font.GothamBold
            checkmark.Parent = checkbox
            
            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(1, -26, 1, 0)
            label.Position = UDim2.new(0, 24, 0, 0)
            label.BackgroundTransparency = 1
            label.Text = icon .. " " .. text
            label.TextColor3 = Color3.fromRGB(220, 220, 220)
            label.TextSize = 11
            label.Font = Enum.Font.GothamMedium
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.Parent = button
            
            return button, checkbox, checkmark
        end

        outputBtn, outputCheck, outputMark = createFilterCheckbox("Output", "ðŸ“", "Output", 1)
        infoBtn, infoCheck, infoMark = createFilterCheckbox("Information", "â„¹ï¸", "Info", 2)
        warnBtn, warnCheck, warnMark = createFilterCheckbox("Warning", "âš ï¸", "Warn", 3)
        errorBtn, errorCheck, errorMark = createFilterCheckbox("Error", "âŒ", "Error", 4)
        
        -- Logs Container UI
        logsContainer = Instance.new("ScrollingFrame")
        logsContainer.Name = "LogsContainer"
        logsContainer.Size = UDim2.new(1, -20, 1, -130)
        logsContainer.Position = UDim2.new(0, 10, 0, 85)
        logsContainer.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
        logsContainer.ScrollBarThickness = 6
        logsContainer.CanvasSize = UDim2.new(0, 0, 0, 0)
        logsContainer.Parent = mainFrame

        logsLayout = Instance.new("UIListLayout")
        logsLayout.SortOrder = Enum.SortOrder.LayoutOrder
        logsLayout.Padding = UDim.new(0, 3)
        logsLayout.Parent = logsContainer
        
        -- Bottom Buttons Frame
        local bottomFrame = Instance.new("Frame")
        bottomFrame.Size = UDim2.new(1, -20, 0, 35)
        bottomFrame.Position = UDim2.new(0, 10, 1, -45)
        bottomFrame.BackgroundTransparency = 1
        bottomFrame.Parent = mainFrame

        local bottomLayout = Instance.new("UIListLayout") -- Tambahkan kembali Layout untuk Bottom Frame
        bottomLayout.FillDirection = Enum.FillDirection.Horizontal
        bottomLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
        bottomLayout.SortOrder = Enum.SortOrder.LayoutOrder
        bottomLayout.Padding = UDim.new(0, 8)
        bottomLayout.Parent = bottomFrame

        local function createBottomButton(text, order)
            local button = Instance.new("TextButton")
            button.Size = UDim2.new(0, 130, 0, 35)
            button.BackgroundColor3 = Color3.fromRGB(50, 120, 220)
            button.BorderSizePixel = 0
            button.Text = text
            button.TextColor3 = Color3.fromRGB(255, 255, 255)
            button.TextSize = 13
            button.Font = Enum.Font.GothamSemibold
            button.LayoutOrder = order
            button.Parent = bottomFrame
            
            local corner = Instance.new("UICorner")
            corner.CornerRadius = UDim.new(0, 8)
            corner.Parent = button
            return button
        end

        copyAllBtn = createBottomButton("ðŸ“‹ Salin Semua", 1)
        copySelectedBtn = createBottomButton("ðŸ“„ Salin Pilihan", 2)

        -- Minimized Frame
        minimizedFrame = Instance.new("Frame")
        minimizedFrame.Name = "MinimizedFrame"
        minimizedFrame.Size = UDim2.new(0, 50, 0, 50)
        minimizedFrame.Position = UDim2.new(1, -60, 1, -60)
        minimizedFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
        minimizedFrame.Visible = false
        minimizedFrame.Active = true
        minimizedFrame.Draggable = true
        minimizedFrame.Parent = screenGui

        minButton = Instance.new("TextButton")
        minButton.Size = UDim2.new(1, 0, 1, 0)
        minButton.BackgroundTransparency = 1
        minButton.Text = "ðŸ“‹"
        minButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        minButton.TextSize = 24
        minButton.Parent = minimizedFrame

        -- =========================================================
        -- PENANGANAN EVENT HANDLERS
        -- =========================================================

        -- LogService Listener
        connections.logConnection = LogService.MessageOut:Connect(function(message, messageType)
            addLog(message, messageType)
        end)

        -- Input (Tombol 'X')
        connections.inputConnection = UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
            if input.KeyCode == Enum.KeyCode.X and not gameProcessedEvent and not isKilled then
                killLogger()
            end
        end)
        
        -- Tombol Header
        closeBtn.MouseButton1Click:Connect(killLogger)
        clearBtn.MouseButton1Click:Connect(function() clearLogs(); addLog("ðŸ—‘ Log telah dibersihkan", Enum.MessageType.MessageInfo) end)
        
        minimizeBtn.MouseButton1Click:Connect(function()
            isMinimized = true
            mainFrame.Visible = false
            minimizedFrame.Visible = true
        end)
        
        minButton.MouseButton1Click:Connect(function()
            isMinimized = false
            minimizedFrame.Visible = false
            mainFrame.Visible = true
        end)
        
        -- FIX: Menghubungkan kembali event handler untuk Copy All
        copyAllBtn.MouseButton1Click:Connect(function()
            if #logs > 0 then
                local allText = ""
                for i, log in ipairs(logs) do 
                    allText = allText .. log.text
                    if i < #logs then
                        allText = allText .. "\n"
                    end
                end
                copyToClipboard(allText)
            else
                addLog("âš ï¸ Tidak ada log untuk disalin", Enum.MessageType.MessageWarning)
            end
        end)
        
        copySelectedBtn.MouseButton1Click:Connect(function()
            if selectedLog then
                for _, log in ipairs(logs) do
                    if log.frame == selectedLog then
                        copyToClipboard(log.text)
                        break
                    end
                end
            else
                addLog("âš ï¸ Pilih log terlebih dahulu", Enum.MessageType.MessageWarning)
            end
        end)

        -- Filter logic
        local function toggleFilter(filterName, checkbox, checkmark)
            filters[filterName] = not filters[filterName]
            if filters[filterName] then
                checkbox.BackgroundColor3 = Color3.fromRGB(50, 150, 220)
                checkmark.Visible = true
            else
                checkbox.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
                checkmark.Visible = false
            end
            updateLogVisibility()
        end

        outputBtn.MouseButton1Click:Connect(function() toggleFilter("Output", outputCheck, outputMark) end)
        infoBtn.MouseButton1Click:Connect(function() toggleFilter("Information", infoCheck, infoMark) end)
        warnBtn.MouseButton1Click:Connect(function() toggleFilter("Warning", warnCheck, warnMark) end)
        errorBtn.MouseButton1Click:Connect(function() toggleFilter("Error", errorCheck, errorMark) end)

        -- Start monitoring setelah UI siap
        startPerfMonitor()
        
        addLog("âœ… Console Logger berhasil dimuat! Tekan 'X' untuk mematikan permanen.", Enum.MessageType.MessageInfo)
    end)
    
    if not success then
        oldPrint("âŒ FATAL ERROR: Console Logger GAGAL inisialisasi. Error: " .. tostring(err))
        killLogger()
    end
end

-- Intercept logs
print = function(...)
    local message = table.concat({...}, " ")
    addLog(message, Enum.MessageType.MessageOutput)
    oldPrint(...)
end

warn = function(...)
    local message = table.concat({...}, " ")
    addLog(message, Enum.MessageType.MessageWarning)
    oldWarn(...)
end


-- Panggil fungsi utama
createUI()

return {
    addLog = addLog,
    clearLogs = function() if not isKilled then clearLogs() end end,
    close = killLogger 
}

