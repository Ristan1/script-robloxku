-- ====================================================================
-- SCRIPT UTAMA: KOMBINASI ANTI-LAG & BOOMBOX MUTE/UNMUTE
--              (REVISI TINGGI FRAME UTAMA)
-- ====================================================================

-- ################
-- I. INISIALISASI
-- ################

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local StarterGui = game:GetService("StarterGui")
local SoundService = game:GetService("SoundService")
local Lighting = game:GetService("Lighting")
local Workspace = game:GetService("Workspace")

-- Variabel Status
local antiLagV1Active = false
local antiLagV2Active = false
local isBoomboxMuted = false
local activeConnections = {}

-- Warna Kunci
local COLOR_BLUE_CALM = Color3.fromRGB(59, 115, 173)    -- Biru Kalem (Digunakan saat Boombox Mute - Belum Aktif)
local COLOR_GREEN_ACTIVE = Color3.fromRGB(50, 205, 50)   -- Hijau Terang (Aktif)
local COLOR_FRAME_BG = Color3.fromRGB(20, 20, 20)        -- Hitam Gelap untuk Frame Background
local COLOR_TITLE_BG = Color3.fromRGB(35, 35, 35)        -- Abu-abu Gelap untuk Judul

-- #############################
-- II. FUNGSI UTILITAS UMUM
-- #############################

local function kirimNotifikasi(judul, teks, durasi)
    StarterGui:SetCore("SendNotification", {
        Title = judul,
        Text = teks,
        Duration = durasi or 5,
    })
end

-- ####################################
-- III. FUNGSI ANTI-LAG V1 & V2 (Logika Dihilangkan untuk Keringkasan)
-- ####################################

local function cleanupDescendant(child)
    if child:IsA("BasePart") then
        child.CastShadow = false
        child.Material = Enum.Material.Plastic
        child.Reflectance = 0
    elseif child:IsA("Decal") or child:IsA("Texture") then
        child.Transparency = 1
    end
end

local function aktifkanAntiLagV1()
    if antiLagV1Active then return end
    antiLagV1Active = true

    pcall(function() settings().Rendering.QualityLevel = Enum.QualityLevel.Level01 end)
    
    local connection = Workspace.DescendantAdded:Connect(function(child)
        task.spawn(function() cleanupDescendant(child) end)
    end)
    table.insert(activeConnections, connection) 

    kirimNotifikasi("Anti-Lag V1 Diaktifkan", "Mode performa dasar telah aktif.", 7)
end

local function aktifkanAntiLagV2()
    if antiLagV2Active then return end
    antiLagV2Active = true
    
    pcall(function() settings().Rendering.QualityLevel = 1 end)
    
    local connection = game.DescendantAdded:Connect(function(value) task.wait(0.5); end)
    table.insert(activeConnections, connection) 

    kirimNotifikasi("Anti-Lag V2 Diaktifkan", "FPS Booster V2 telah aktif!", 7)
end


-- ####################################
-- IV. FUNGSI MUSIK/BOOMBOX
-- ####################################

local BOOMBOX_KEYWORDS = {"boombox", "radio", "music", "audio", "sound"}

local function setBoomboxVolume(descendant, volume)
    if descendant:IsA("Sound") then
        local nameLower = descendant.Name:lower()
        local isTargetSound = false
        for _, keyword in ipairs(BOOMBOX_KEYWORDS) do
            if nameLower:find(keyword) then
                isTargetSound = true
                break
            end
        end
        
        if isTargetSound then
            descendant.Volume = volume
        end
    end
end

local function toggleBoombox(shouldMute)
    isBoomboxMuted = shouldMute
    local targetVolume = shouldMute and 0 or 1
    
    for _, obj in ipairs(game:GetDescendants()) do
        setBoomboxVolume(obj, targetVolume)
    end
    
    game:GetService("SoundService").RespectFilteringEnabled = false 
end

local descendantAddedConnectionBoombox = game.DescendantAdded:Connect(function(descendant)
    if isBoomboxMuted then
        setBoomboxVolume(descendant, 0)
    end
end)
table.insert(activeConnections, descendantAddedConnectionBoombox)


-- ####################################
-- V. PEMBUATAN GUI UTAMA (SCREEN GUI)
-- ####################################

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "CombinedUtilityGUI"
screenGui.Parent = PlayerGui
screenGui.ResetOnSpawn = false

-- Frame utama: TINGGI DITINGKATKAN DARI 185 MENJADI 205
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 260, 0, 205) 
mainFrame.Position = UDim2.new(0.5, -130, 0.5, -102.5) -- Posisi Y disesuaikan agar tetap di tengah
mainFrame.BackgroundColor3 = COLOR_FRAME_BG 
mainFrame.BorderSizePixel = 1
mainFrame.BorderColor3 = COLOR_TITLE_BG
mainFrame.Draggable = true
mainFrame.Active = true
mainFrame.Parent = screenGui

local uiCornerFrame = Instance.new("UICorner")
uiCornerFrame.CornerRadius = UDim.new(0, 8)
uiCornerFrame.Parent = mainFrame

-- Judul
local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, 0, 0, 35) 
titleLabel.BackgroundColor3 = COLOR_TITLE_BG 
titleLabel.Text = "Menu Pilihan antilag"
titleLabel.Font = Enum.Font.SourceSansBold
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255) 
titleLabel.TextSize = 18
titleLabel.Parent = mainFrame

-- Tombol Close (X)
local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 30, 0, 30)
closeButton.Position = UDim2.new(1, -33, 0, 3)
closeButton.BackgroundColor3 = COLOR_TITLE_BG
closeButton.Text = "‚ùå"
closeButton.Font = Enum.Font.SourceSansBold
closeButton.TextColor3 = Color3.fromRGB(255, 100, 100)
closeButton.TextSize = 18
closeButton.BackgroundTransparency = 1
closeButton.Parent = titleLabel

-- Container Tombol
local buttonContainer = Instance.new("Frame")
-- Size Y disesuaikan: Tinggi Frame (205) - Tinggi Judul (35) = 170. Padding top 40.
buttonContainer.Size = UDim2.new(1, -20, 1, -50)
buttonContainer.Position = UDim2.new(0, 10, 0, 40)
buttonContainer.BackgroundTransparency = 1
buttonContainer.Parent = mainFrame

local gridLayout = Instance.new("UIGridLayout")
gridLayout.CellSize = UDim2.new(1, 0, 0, 45)
gridLayout.CellPadding = UDim2.new(0, 0, 0, 8)
gridLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
gridLayout.VerticalAlignment = Enum.VerticalAlignment.Top
gridLayout.Parent = buttonContainer

local function createButton(name, text)
    local btn = Instance.new("TextButton")
    btn.Name = name
    btn.Text = text
    btn.Font = Enum.Font.SourceSansBold
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.TextSize = 16
    btn.BackgroundColor3 = COLOR_BLUE_CALM
    btn.Parent = buttonContainer

    local uiCorner = Instance.new("UICorner")
    uiCorner.CornerRadius = UDim.new(0, 6)
    uiCorner.Parent = btn
    
    return btn
end

local buttonV1 = createButton("ButtonV1", "Anti-Lag V1 (Dasar)")
local buttonV2 = createButton("ButtonV2", "Anti-Lag V2 (Lanjutan)")
local buttonBoombox = createButton("ButtonBoombox", "Musik & Boombox: MUTE")


-- ####################################
-- VI. KONEKSI EVENT
-- ####################################

local function updateBoomboxButtonDisplay()
    if isBoomboxMuted then
        buttonBoombox.Text = "Musik & Boombox: UNMUTE"
        buttonBoombox.BackgroundColor3 = COLOR_GREEN_ACTIVE
    else
        buttonBoombox.Text = "Musik & Boombox: MUTE"
        buttonBoombox.BackgroundColor3 = COLOR_BLUE_CALM
    end
end

local function updateAntiLagButtonDisplay()
    if antiLagV1Active then
        buttonV1.Text = "V1 AKTIF"
        buttonV1.BackgroundColor3 = COLOR_GREEN_ACTIVE
        buttonV1.Active = false
        buttonV1.Selectable = false
    else
        buttonV1.Text = "Anti-Lag V1 (Dasar)"
        buttonV1.BackgroundColor3 = COLOR_BLUE_CALM
        buttonV1.Active = true
        buttonV1.Selectable = true
    end

    if antiLagV2Active then
        buttonV2.Text = "V2 AKTIF"
        buttonV2.BackgroundColor3 = COLOR_GREEN_ACTIVE
        buttonV2.Active = false
        buttonV2.Selectable = false
    else
        buttonV2.Text = "Anti-Lag V2 (Lanjutan)"
        buttonV2.BackgroundColor3 = COLOR_BLUE_CALM
        buttonV2.Active = true
        buttonV2.Selectable = true
    end
end

updateBoomboxButtonDisplay()
updateAntiLagButtonDisplay()

buttonV1.MouseButton1Click:Connect(function()
    if antiLagV1Active then return end
    aktifkanAntiLagV1()
    updateAntiLagButtonDisplay()
end)

buttonV2.MouseButton1Click:Connect(function()
    if antiLagV2Active then return end
    aktifkanAntiLagV2()
    updateAntiLagButtonDisplay()
end)

buttonBoombox.MouseButton1Click:Connect(function()
    if isBoomboxMuted then
        toggleBoombox(false)
        kirimNotifikasi("Boombox", "Musik Boombox Dinyalakan üîä", 3)
    else
        toggleBoombox(true)
        kirimNotifikasi("Boombox", "Musik Boombox Dimatikan üîá", 3)
    end
    updateBoomboxButtonDisplay()
end)

closeButton.MouseButton1Click:Connect(function()
    for _, connection in ipairs(activeConnections) do
        if connection and typeof(connection) == "RBXScriptConnection" and connection.Connected then
            connection:Disconnect()
        end
    end
    screenGui:Destroy()
end)
