-- ====================================================================
-- SCRIPT UTAMA: KOMBINASI ANTI-LAG V1, V2, V3 & BOOMBOX MUTE/UNMUTE
-- (FINAL FIXED: SEMUA STATUS PERSISTEN MESKI GUI DIBUKA/DITUTUP)
-- ====================================================================

-- ################
-- I. INISIALISASI
-- ################

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local StarterGui = game:GetService("StarterGui")
local SoundService = game:GetService("SoundService")
local Lighting = game:GetService("Lighting")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local MaterialService = game:GetService("MaterialService")
local Terrain = Workspace:FindFirstChildOfClass("Terrain")

-- Variabel Status Global Persisten (BARU: V1 dan Boombox dipindahkan ke _G)
if _G.antiLagV1Active == nil then _G.antiLagV1Active = false end -- Status V1
if _G.isBoomboxMuted == nil then _G.isBoomboxMuted = false end    -- Status Boombox
if _G.antiLagV2Active == nil then _G.antiLagV2Active = false end
if _G.antiLagV3Active == nil then _G.antiLagV3Active = false end

-- Variabel Status Lokal (Hanya untuk koneksi internal dan referensi)
local activeConnections = {}
local V1DescendantConnection 
local V2_CONNECTION_DESCENDANT
local V3_CONNECTION_DESCENDANT

-- Variabel Global FPS Booster (Digunakan oleh V2)
if not _G.Ignore then _G.Ignore = {} end
if _G.SendNotifications == nil then _G.SendNotifications = true end
if _G.ConsoleLogs == nil then _G.ConsoleLogs = false end
if not _G.Settings then
    _G.Settings = {}
end

-- Pengaturan V2 (Jika belum ada)
if not _G.Settings.V2 then
    _G.Settings.V2 = {
        Players = {["Ignore Me"] = true, ["Ignore Others"] = true, ["Ignore Tools"] = true},
        Meshes = {NoMesh = false, NoTexture = false, Destroy = false},
        Images = {Invisible = true, Destroy = false},
        Explosions = {Smaller = true, Invisible = false, Destroy = false},
        Particles = {Invisible = true, Destroy = false},
        TextLabels = {LowerQuality = false, Invisible = false, Destroy = false},
        MeshParts = {LowerQuality = true, Invisible = false, NoTexture = false, NoMesh = false, Destroy = false},
        Other = {
            ["FPS Cap"] = true, ["No Camera Effects"] = true, ["No Clothes"] = true, 
            ["Low Water Graphics"] = true, ["No Shadows"] = true, ["Low Rendering"] = true,
            ["Low Quality Parts"] = true, ["Low Quality Models"] = true, ["Reset Materials"] = true,
            ["Lower Quality MeshParts"] = true, ClearNilInstances = false
        }
    }
end

-- Pengaturan V3 (Diambil dari skrip baru)
if not _G.Settings.V3 then
    _G.Settings.V3 = {
        Graphics = {
            FPS = 120,
            QualityLevel = 1,
            MeshPartDetail = 1,
            WaterQuality = 0,
            ShadowQuality = 0,
            MaterialQuality = 0,
            RemoveSky = true,
            RemoveAtmosphere = true,
            RemoveClouds = true
        },
        Optimizations = {
            RemoveClothing = true,
            RemoveAccessories = true,
            RemoveParticles = true,
            RemoveEffects = true,
            RemoveTextures = true,
            RemoveMeshes = false,
            RemoveExplosions = true,
            RemovePostEffects = true,
            RemoveLights = true,
            RemoveDecals = true
        },
        Notifications = true
    }
end


-- Warna Kunci
local COLOR_BLUE_CALM = Color3.fromRGB(59, 115, 173)
local COLOR_GREEN_ACTIVE = Color3.fromRGB(50, 205, 50)
local COLOR_FRAME_BG = Color3.fromRGB(20, 20, 20)
local COLOR_TITLE_BG = Color3.fromRGB(35, 35, 35)

-- #############################
-- II. FUNGSI UTILITAS UMUM
-- #############################

local function kirimNotifikasi(judul, teks, durasi)
    StarterGui:SetCore("SendNotification", {
        Title = judul,
        Text = teks,
        Duration = durasi or 5,
    })
end

-- ####################################
-- III. FUNGSI ANTI-LAG V1
-- ####################################

local function applyAntiLagV1()
    if Terrain then
        Terrain.WaterWaveSize = 0
        Terrain.WaterWaveSpeed = 0
        Terrain.WaterReflectance = 0
        Terrain.WaterTransparency = 1
    end
    
    Lighting.GlobalShadows = false
    Lighting.FogEnd = 9e9
    Lighting.FogStart = 9e9
    pcall(function() settings().Rendering.QualityLevel = 1 end)
    
    for _, v in pairs(game:GetDescendants()) do
        if v:IsA("BasePart") then
            v.CastShadow = false
            v.Material = Enum.Material.Plastic
            v.Reflectance = 0
        elseif v:IsA("Decal") then
            v.Transparency = 1
            v.Texture = ""
        elseif v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Fire") or v:IsA("Smoke") or v:IsA("Sparkles") or v:IsA("Beam") then
            v.Enabled = false
        end
        if v:IsA("PostEffect") and v.Parent == Lighting then
            v.Enabled = false
        end
    end
    
    -- Menggunakan _G.antiLagV1Active
    if _G.antiLagV1Active and not V1DescendantConnection then
        V1DescendantConnection = Workspace.DescendantAdded:Connect(function(child)
            if not _G.antiLagV1Active then return end
            task.spawn(function()
                if child:IsA("BasePart") then
                    child.CastShadow = false
                    child.Material = Enum.Material.Plastic
                    child.Reflectance = 0
                elseif child:IsA("Decal") then
                    child.Transparency = 1
                    child.Texture = ""
                elseif child:IsA("ParticleEmitter") or child:IsA("Trail") or child:IsA("Fire") or child:IsA("Smoke") or child:IsA("Sparkles") or child:IsA("Beam") then
                    child.Enabled = false
                end
            end)
        end)
        table.insert(activeConnections, V1DescendantConnection)
    end
end

local function restoreGraphicsV1()
    Lighting.GlobalShadows = true
    Lighting.FogEnd = 100000
    Lighting.FogStart = 0
    pcall(function() settings().Rendering.QualityLevel = Enum.QualityLevel.Level10 end)

    if V1DescendantConnection and V1DescendantConnection.Connected then
        V1DescendantConnection:Disconnect()
        V1DescendantConnection = nil
        -- Tidak perlu menghapus dari activeConnections karena V1DescendantConnection bisa aktif/nonaktif
    end
end

local function toggleAntiLagV1(shouldActivate)
    -- Menggunakan status global
    if shouldActivate then
        if _G.antiLagV1Active then return end
        _G.antiLagV1Active = true
        applyAntiLagV1()
        kirimNotifikasi("Anti-Lag V1 Diaktifkan", "Mode performa penuh telah aktif (Grafis Rendah, Efek Mati).", 7)
    else
        if not _G.antiLagV1Active then return end
        _G.antiLagV1Active = false
        restoreGraphicsV1()
        kirimNotifikasi("Anti-Lag V1 Dinonaktifkan", "Pengaturan grafis dasar dipulihkan.", 5)
    end
end

-- ####################################
-- IV. FUNGSI ANTI-LAG V2 (Status Global digunakan)
-- ####################################

local ME = Players.LocalPlayer
local CanBeEnabled = {"ParticleEmitter", "Trail", "Smoke", "Fire", "Sparkles"}

local function PartOfCharacter(Inst)
    for i, v in pairs(Players:GetPlayers()) do
        if v ~= ME and v.Character and Inst:IsDescendantOf(v.Character) then return true end
    end
    return false
end
local function DescendantOfIgnore(Inst)
    for i, v in pairs(_G.Ignore) do
        if Inst:IsDescendantOf(v) then return true end
    end
    return false
end
local function CheckIfBadV2(Inst)
    local Settings = _G.Settings.V2
    local isIgnored = (Settings.Players["Ignore Others"] and not PartOfCharacter(Inst))
                      or (Settings.Players["Ignore Me"] and ME.Character and not Inst:IsDescendantOf(ME.Character))
                      or (Settings.Players["Ignore Tools"] and not Inst:IsA("BackpackItem") and not Inst:FindFirstAncestorWhichIsA("BackpackItem"))
                      or (_G.Ignore and not table.find(_G.Ignore, Inst) and not DescendantOfIgnore(Inst))

    if not Inst:IsDescendantOf(Players) and not isIgnored then
        if Inst:IsA("DataModelMesh") then
            if Inst:IsA("SpecialMesh") then
                if Settings.Meshes.NoMesh then Inst.MeshId = "" end
                if Settings.Meshes.NoTexture then Inst.TextureId = "" end
            end
            if Settings.Meshes.Destroy or Settings["No Meshes"] then Inst:Destroy() end
        elseif Inst:IsA("FaceInstance") then
            if Settings.Images.Invisible then Inst.Transparency = 1; Inst.Shiny = 1 end
            if Settings.Images.LowDetail then Inst.Shiny = 1 end
            if Settings.Images.Destroy then Inst:Destroy() end
        elseif Inst:IsA("ShirtGraphic") then
            if Settings.Images.Invisible then Inst.Graphic = "" end
            if Settings.Images.Destroy then Inst:Destroy() end
        elseif table.find(CanBeEnabled, Inst.ClassName) then
            if Settings.Particles.Invisible then Inst.Enabled = false end
            if Settings.Particles.Destroy then Inst:Destroy() end
        elseif Inst:IsA("PostEffect") and Settings.Other["No Camera Effects"] then Inst.Enabled = false
        elseif Inst:IsA("Explosion") then
            if Settings.Explosions.Smaller then Inst.BlastPressure = 1; Inst.BlastRadius = 1 end
            if Settings.Explosions.Invisible then Inst.BlastPressure = 1; Inst.BlastRadius = 1; Inst.Visible = false end
            if Settings.Explosions.Destroy then Inst:Destroy() end
        elseif Inst:IsA("Clothing") or Inst:IsA("SurfaceAppearance") or Inst:IsA("BaseWrap") then
            if Settings.Other["No Clothes"] then Inst:Destroy() end
        elseif Inst:IsA("BasePart") and not Inst:IsA("MeshPart") then
            if Settings.Other["Low Quality Parts"] then Inst.Material = Enum.Material.Plastic; Inst.Reflectance = 0 end
        elseif Inst:IsA("TextLabel") and Inst:IsDescendantOf(workspace) then
            if Settings.TextLabels.LowerQuality then Inst.Font = Enum.Font.SourceSans; Inst.TextScaled = false; Inst.RichText = false; Inst.TextSize = 14 end
            if Settings.TextLabels.Invisible then Inst.Visible = false end
            if Settings.TextLabels.Destroy then Inst:Destroy() end
        elseif Inst:IsA("Model") then
            if Settings.Other["Low Quality Models"] then Inst.LevelOfDetail = 1 end
        elseif Inst:IsA("MeshPart") then
            if Settings.MeshParts.LowerQuality then Inst.RenderFidelity = 2; Inst.Reflectance = 0; Inst.Material = Enum.Material.Plastic end
            if Settings.MeshParts.Invisible then Inst.Transparency = 1; Inst.RenderFidelity = 2; Inst.Reflectance = 0; Inst.Material = Enum.Material.Plastic end
            if Settings.MeshParts.NoTexture then Inst.TextureID = "" end
            if Settings.MeshParts.NoMesh then Inst.MeshId = "" end
            if Settings.MeshParts.Destroy then Inst:Destroy() end
        end
    end
end

local function aktifkanAntiLagV2()
    if _G.antiLagV2Active then return end
    _G.antiLagV2Active = true 
    local Settings = _G.Settings.V2
    
    if not game:IsLoaded() then
        repeat task.wait() until game:IsLoaded()
    end
    
    -- Penerapan Global Settings
    coroutine.wrap(pcall)(function()
        if Settings.Other["Low Water Graphics"] and Terrain then
            Terrain.WaterWaveSize = 0; Terrain.WaterWaveSpeed = 0; Terrain.WaterReflectance = 0; Terrain.WaterTransparency = 0
            kirimNotifikasi("V2 Booster", "Low Water Graphics Enabled", 5)
        end
    end)
    coroutine.wrap(pcall)(function()
        if Settings.Other["No Shadows"] then
            Lighting.GlobalShadows = false; Lighting.FogEnd = 9e9; Lighting.ShadowSoftness = 0
            kirimNotifikasi("V2 Booster", "No Shadows Enabled", 5)
        end
    end)
    coroutine.wrap(pcall)(function()
        if Settings.Other["Low Rendering"] then
            settings().Rendering.QualityLevel = 1
            settings().Rendering.MeshPartDetailLevel = Enum.MeshPartDetailLevel.Level04
            kirimNotifikasi("V2 Booster", "Low Rendering Enabled", 5)
        end
    end)
    coroutine.wrap(pcall)(function()
        if Settings.Other["Reset Materials"] then
            for i, v in pairs(MaterialService:GetChildren()) do v:Destroy() end
            MaterialService.Use2022Materials = false
            kirimNotifikasi("V2 Booster", "Reset Materials Enabled", 5)
        end
    end)
    coroutine.wrap(pcall)(function()
        if Settings.Other["FPS Cap"] then
            if setfpscap then
                setfpscap(1e6)
                kirimNotifikasi("V2 Booster", "FPS Uncapped", 5)
            else
                kirimNotifikasi("V2 Booster", "FPS Cap Failed", 5)
            end
        end
    end)
    coroutine.wrap(pcall)(function()
        if Settings.Other["ClearNilInstances"] and getnilinstances then
            for _, v in pairs(getnilinstances()) do pcall(v.Destroy, v) end
            kirimNotifikasi("V2 Booster", "Cleared Nil Instances", 5)
        end
    end)

    -- Penerapan ke Instance yang Sudah Ada
    local descendants = game:GetDescendants()
    kirimNotifikasi("V2 Booster", "Checking " .. #descendants .. " Instances...", 10)
    for i, v in pairs(descendants) do
        CheckIfBadV2(v)
    end

    -- Koneksi untuk Instance Baru
    V2_CONNECTION_DESCENDANT = game.DescendantAdded:Connect(function(value)
        if not _G.antiLagV2Active then return end
        task.wait(_G.LoadedWait or 0.1)
        CheckIfBadV2(value)
    end)
    table.insert(activeConnections, V2_CONNECTION_DESCENDANT)
    
    kirimNotifikasi("V2 Booster", "FPS Booster Loaded! (ANTI-LAG V2)", 7)
end

-- ####################################
-- V. FUNGSI ANTI-LAG V3 (Status Global digunakan)
-- ####################################

local function showV3Notification(title, text, duration)
    if not _G.Settings.V3.Notifications then return end
    
    StarterGui:SetCore("SendNotification", {
        Title = title,
        Text = text,
        Duration = duration or 5,
        Button1 = "Okay"
    })
end

local function optimizeGraphicsV3()
    local Settings = _G.Settings.V3.Graphics
    showV3Notification("FPS Booster V3", "Starting optimizations...", 2)
    task.wait(0.5)
    
    -- Set FPS
    local success, err = pcall(function()
        if setfpscap then
            showV3Notification("FPS Booster V3", "Setting FPS to " .. Settings.FPS, 2)
            setfpscap(Settings.FPS)
        else
            showV3Notification("FPS Booster V3", "FPS Cap (setfpscap) not supported by executor.", 3)
        end
    end)
    if not success then
        showV3Notification("FPS Booster V3", "Error setting FPS: " .. err, 3)
    end
    task.wait(0.5)
    
    -- Optimize rendering
    showV3Notification("FPS Booster V3", "Optimizing rendering quality...", 2)
    settings().Rendering.QualityLevel = Settings.QualityLevel
    settings().Rendering.MeshPartDetailLevel = Enum.MeshPartDetailLevel.Level01
    task.wait(0.5)
    
    -- Optimize lighting
    showV3Notification("FPS Booster V3", "Removing shadows and fog...", 2)
    Lighting.GlobalShadows = false
    Lighting.ShadowSoftness = 0
    Lighting.FogEnd = 9e9
    task.wait(0.5)
    
    -- Optimize terrain
    if Terrain then
        showV3Notification("FPS Booster V3", "Optimizing water effects...", 2)
        Terrain.WaterWaveSize = Settings.WaterQuality
        Terrain.WaterWaveSpeed = 0
        Terrain.WaterReflectance = 0
        Terrain.WaterTransparency = 0
        pcall(sethiddenproperty, Terrain, "Decoration", false)
        task.wait(0.5)
    end

    -- Aggressively remove Sky, Atmosphere, and Clouds
    if Settings.RemoveSky then
        showV3Notification("FPS Booster V3", "Removing sky elements...", 2)
        for _, v in pairs(Lighting:GetDescendants()) do
            if v:IsA("Sky") or v:IsA("Atmosphere") or v:IsA("Clouds") then v:Destroy() end
        end
        for _, v in pairs(Workspace:GetDescendants()) do
            if v:IsA("Sky") or v:IsA("Atmosphere") or v:IsA("Clouds") then v:Destroy() end
        end
        task.wait(0.5)
    end
end

local function optimizeInstanceV3(instance)
    if not instance or not _G.antiLagV3Active then return end
    local Settings = _G.Settings.V3.Optimizations
    
    if Settings.RemoveClothing and (instance:IsA("Clothing") or instance:IsA("SurfaceAppearance")) then
        instance:Destroy()
        return
    end
    
    if Settings.RemoveParticles and (instance:IsA("ParticleEmitter") or instance:IsA("Trail") or instance:IsA("Smoke") or instance:IsA("Fire") or instance:IsA("Sparkles")) then
        instance.Enabled = false
        return
    end
    
    if Settings.RemoveTextures and instance:IsA("Texture") then
        instance.Transparency = 1
        return
    end
    
    if Settings.RemoveMeshes and instance:IsA("SpecialMesh") then
        instance.MeshId = ""
        return
    end
    
    if Settings.RemoveExplosions and instance:IsA("Explosion") then
        instance.BlastPressure = 1
        instance.BlastRadius = 1
        instance.Visible = false
        return
    end
    
    if Settings.RemovePostEffects and instance:IsA("PostEffect") then
        instance.Enabled = false
        return
    end

    if Settings.RemoveLights and (instance:IsA("SpotLight") or instance:IsA("PointLight") or instance:IsA("SurfaceLight")) then
        instance.Enabled = false
        instance:Destroy()
        return
    end

    if Settings.RemoveEffects and instance:IsA("Beam") then
        instance.Enabled = false
        return
    end

    if Settings.RemoveDecals and instance:IsA("Decal") then
        instance.Transparency = 1
        instance:Destroy()
        return
    end
    
    if instance:IsA("BasePart") then
        instance.Material = Enum.Material.Plastic
        instance.Reflectance = 0
    end

    if _G.Settings.V3.Graphics.RemoveSky and (instance:IsA("Sky") or instance:IsA("Atmosphere") or instance:IsA("Clouds")) then
        instance:Destroy()
        return
    end
end

local function aktifkanAntiLagV3()
    if _G.antiLagV3Active then return end
    _G.antiLagV3Active = true

    showV3Notification("FPS Booster V3", "Loading FPS Booster...", math.huge)
    task.wait(1)

    local success, err = pcall(function()
        optimizeGraphicsV3()
        
        -- Optimize existing instances
        showV3Notification("FPS Booster V3", "Optimizing existing game objects...", 2)
        for _, instance in pairs(game:GetDescendants()) do
            optimizeInstanceV3(instance)
        end
        task.wait(0.5)
        
        -- Optimize new instances
        showV3Notification("FPS Booster V3", "Monitoring new game objects...", 2)
        V3_CONNECTION_DESCENDANT = game.DescendantAdded:Connect(optimizeInstanceV3)
        table.insert(activeConnections, V3_CONNECTION_DESCENDANT)
        task.wait(0.5)
        
        -- Final progress notification
        showV3Notification("FPS Booster V3", "Optimizations completed successfully!", 2)
        task.wait(2)

        showV3Notification("FPS Booster V3", "FPS BOOSTED BY BLOXSTORE", 7)

    end)
    if not success then
        _G.antiLagV3Active = false
        showV3Notification("FPS Booster V3", "Script Failed: " .. err, 5)
    end
end

-- ####################################
-- VI. FUNGSI MUSIK/BOOMBOX (Status Global digunakan)
-- ####################################

local BOOMBOX_KEYWORDS = {"boombox", "radio", "music", "audio", "sound"}

local function setBoomboxVolume(descendant, volume)
    if descendant:IsA("Sound") then
        local nameLower = descendant.Name:lower()
        local isTargetSound = false
        for _, keyword in ipairs(BOOMBOX_KEYWORDS) do
            if nameLower:find(keyword) then
                isTargetSound = true
                break
            end
        end
        
        if isTargetSound then
            descendant.Volume = volume
        end
    end
end

local function toggleBoombox(shouldMute)
    _G.isBoomboxMuted = shouldMute -- Tulis status ke Global
    local targetVolume = shouldMute and 0 or 1
    
    for _, obj in ipairs(game:GetDescendants()) do
        setBoomboxVolume(obj, targetVolume)
    end
    
    game:GetService("SoundService").RespectFilteringEnabled = false 
end

-- Koneksi DescendantAdded Boombox harus selalu ada dan membaca status Global
local descendantAddedConnectionBoombox = game.DescendantAdded:Connect(function(descendant)
    if _G.isBoomboxMuted then -- Baca status dari Global
        setBoomboxVolume(descendant, 0)
    end
end)
table.insert(activeConnections, descendantAddedConnectionBoombox)

-- APLIKASIKAN STATUS BOOMBOX SAAT SCRIPT DIMUAT ULANG
toggleBoombox(_G.isBoomboxMuted)


-- ####################################
-- VII. PEMBUATAN GUI UTAMA
-- ####################################

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "CombinedUtilityGUI"
screenGui.Parent = PlayerGui
screenGui.ResetOnSpawn = false

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 260, 0, 258)
mainFrame.Position = UDim2.new(0.5, -130, 0.5, -129) 
mainFrame.BackgroundColor3 = COLOR_FRAME_BG 
mainFrame.BorderSizePixel = 1
mainFrame.BorderColor3 = COLOR_TITLE_BG
mainFrame.Draggable = true
mainFrame.Active = true
mainFrame.Parent = screenGui

local uiCornerFrame = Instance.new("UICorner")
uiCornerFrame.CornerRadius = UDim.new(0, 8)
uiCornerFrame.Parent = mainFrame

local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, 0, 0, 35) 
titleLabel.BackgroundColor3 = COLOR_TITLE_BG 
titleLabel.Text = "Menu Pilihan antilag"
titleLabel.Font = Enum.Font.SourceSansBold
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255) 
titleLabel.TextSize = 18
titleLabel.Parent = mainFrame

local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 30, 0, 30)
closeButton.Position = UDim2.new(1, -33, 0, 3)
closeButton.BackgroundColor3 = COLOR_TITLE_BG
closeButton.Text = "❌"
closeButton.Font = Enum.Font.SourceSansBold
closeButton.TextColor3 = Color3.fromRGB(255, 100, 100)
closeButton.TextSize = 18
closeButton.BackgroundTransparency = 1
closeButton.Parent = titleLabel

local buttonContainer = Instance.new("Frame")
buttonContainer.Size = UDim2.new(1, -20, 1, -50)
buttonContainer.Position = UDim2.new(0, 10, 0, 40)
buttonContainer.BackgroundTransparency = 1
buttonContainer.Parent = mainFrame

local gridLayout = Instance.new("UIGridLayout")
gridLayout.CellSize = UDim2.new(1, 0, 0, 45)
gridLayout.CellPadding = UDim2.new(0, 0, 0, 8)
gridLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
gridLayout.VerticalAlignment = Enum.VerticalAlignment.Top
gridLayout.Parent = buttonContainer

local function createButton(name, text)
    local btn = Instance.new("TextButton")
    btn.Name = name
    btn.Text = text
    btn.Font = Enum.Font.SourceSansBold
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.TextSize = 16
    btn.BackgroundColor3 = COLOR_BLUE_CALM
    btn.Parent = buttonContainer

    local uiCorner = Instance.new("UICorner")
    uiCorner.CornerRadius = UDim.new(0, 6)
    uiCorner.Parent = btn
    
    return btn
end

local buttonV1 = createButton("ButtonV1", "Anti-Lag V1 (Grafis Penuh)")
local buttonV2 = createButton("ButtonV2", "Anti-Lag V2 (FPS Booster)")
local buttonV3 = createButton("ButtonV3", "Anti-Lag V3 (FPS Booster BloxStore)")
local buttonBoombox = createButton("ButtonBoombox", "Musik & Boombox: MUTE")


-- ####################################
-- VIII. KONEKSI EVENT
-- ####################################

local function updateBoomboxButtonDisplay()
    -- Baca status dari Global
    if _G.isBoomboxMuted then
        buttonBoombox.Text = "Musik & Boombox: UNMUTE"
        buttonBoombox.BackgroundColor3 = COLOR_GREEN_ACTIVE
    else
        buttonBoombox.Text = "Musik & Boombox: MUTE"
        buttonBoombox.BackgroundColor3 = COLOR_BLUE_CALM
    end
end

local function updateAntiLagButtonDisplay()
    
    -- V1 (Status Global)
    if _G.antiLagV1Active then
        buttonV1.Text = "V1 AKTIF (Grafis Penuh)"
        buttonV1.BackgroundColor3 = COLOR_GREEN_ACTIVE
    else
        buttonV1.Text = "Anti-Lag V1 (Grafis Penuh)"
        buttonV1.BackgroundColor3 = COLOR_BLUE_CALM
    end

    -- V2 (Status Global)
    if _G.antiLagV2Active then
        buttonV2.Text = "V2 AKTIF (FPS BOOSTER)"
        buttonV2.BackgroundColor3 = COLOR_GREEN_ACTIVE
        buttonV2.Active = false
        buttonV2.Selectable = false
    else
        buttonV2.Text = "Anti-Lag V2 (FPS Booster)"
        buttonV2.BackgroundColor3 = COLOR_BLUE_CALM
        buttonV2.Active = true
        buttonV2.Selectable = true
    end

    -- V3 (Status Global)
    if _G.antiLagV3Active then
        buttonV3.Text = "V3 AKTIF (BLOXX STORE)"
        buttonV3.BackgroundColor3 = COLOR_GREEN_ACTIVE
        buttonV3.Active = false
        buttonV3.Selectable = false
    else
        buttonV3.Text = "Anti-Lag V3 (FPS Booster BloxStore)"
        buttonV3.BackgroundColor3 = COLOR_BLUE_CALM
        buttonV3.Active = true
        buttonV3.Selectable = true
    end
end

updateBoomboxButtonDisplay()
updateAntiLagButtonDisplay()

buttonV1.MouseButton1Click:Connect(function()
    -- Menggunakan status Global
    if _G.antiLagV1Active then
        toggleAntiLagV1(false)
    else
        toggleAntiLagV1(true)
    end
    updateAntiLagButtonDisplay()
end)

buttonV2.MouseButton1Click:Connect(function()
    if not _G.antiLagV2Active then
        aktifkanAntiLagV2()
    end
    updateAntiLagButtonDisplay()
end)

buttonV3.MouseButton1Click:Connect(function()
    if not _G.antiLagV3Active then
        aktifkanAntiLagV3()
    end
    updateAntiLagButtonDisplay()
end)

buttonBoombox.MouseButton1Click:Connect(function()
    -- Menggunakan status Global
    if _G.isBoomboxMuted then
        toggleBoombox(false)
        kirimNotifikasi("Boombox", "Musik Boombox Dinyalakan 🔊", 3)
    else
        toggleBoombox(true)
        kirimNotifikasi("Boombox", "Musik Boombox Dimatikan 🔇", 3)
    end
    updateBoomboxButtonDisplay()
end)

closeButton.MouseButton1Click:Connect(function()
    -- Semua status (V1, V2, V3, Boombox) persisten.
    screenGui:Destroy()
end)
